---
title: "ã€React,Reduxã€‘JEST+testing-library+MSWã§å§‹ã‚ã‚‹ãƒ†ã‚¹ãƒˆå…¥é–€"
emoji: "ğŸ“"
type: "tech"
topics:
  - "react"
  - "test"
  - "redux"
  - "jest"
  - "msw"
published: true
published_at: "2022-06-12 13:14"
---

ã“ã‚“ã«ã¡ã¯ã€@nerusanã§ã™ã€‚
æœ¬æ—¥ã¯ã€ãƒ†ã‚¹ãƒˆã«é–¢ã™ã‚‹ã“ã¨ã‚’è¨˜äº‹ã«ã—ã¾ã™ã€‚
çš†ã•ã‚“ã¯ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã¯è¨˜è¿°ã—ã¦ã„ã¾ã™ã§ã—ã‚‡ã†ã‹ï¼Ÿ
è‡ªèº«ãŒæ‰€å±ã—ã¦ã„ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚‚æœ€è¿‘å°å…¥ã—ãŸã®ã§ã€ãã®æ™‚å­¦ã‚“ã ã“ã¨ã‚’æ›¸ãã¾ã™ã€‚

ä»Šå›ã¯ã€React, ReduxToolKitã‚’å‰æã¨ã—ãŸãƒ†ã‚¹ãƒˆã‚’æƒ³å®šã—ã¦ãŠã‚Šã¾ã™ã€‚
åˆ©ç”¨ã—ãŸãƒ„ãƒ¼ãƒ«ã¯ä»¥ä¸‹ã§ã™ã€‚

- JEST
	- ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
	- ãƒ†ã‚¹ãƒˆã®æ çµ„ã¿ã‚’æä¾›(describe(), test()ãªã©)
- @testing-library/react
	- Reactã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã€HTMLã‚’è¡¨ç¤ºã—ãŸã‚Šã§ãã‚‹
- @testing-library/jest-dom
	- ä¾¿åˆ©ãªã‚«ã‚¹ã‚¿ãƒ ãƒãƒƒãƒãƒ£ãŒä½¿ãˆã‚‹
- @testing-library/user-event 
	- ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œã‚„ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ã€ãƒã‚¦ã‚¹æ“ä½œãªã©ãƒ¦ãƒ¼ã‚¶ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ã‚’æ‰±ã†
- msw
	- Mock Service Workder
	- ã‚µãƒ¼ãƒãƒ¼ã‚’ãƒ¢ãƒƒã‚¯ã—ã€APIã®ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã™ã‚‹


# å°å…¥

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§å°å…¥

```sh:shell
$ yarn add -D @testing-library/jest-dom @testing-library/react @testing-library/user-event msw
```


# ç°¡å˜ãªãƒ†ã‚¹ãƒˆã‚’ã—ã¦ã¿ã‚ˆã†

ä»¥ä¸‹ç°¡å˜ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«å¯¾ã—ã¦ã€ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã¿ã¾ã—ãŸã€‚


```tsx:Render.tsx
import React from "react";
import { useQuery } from "react-query";

const Render = () => {
  const [value, setValue] = React.useState("");
  window.setTimeout(() => {
    setValue("async data");
  }, 1000);
  
  return (
    <div>
      <h1>ã‚µãƒ³ãƒ—ãƒ«</h1>
      <input type="text" />
      <button>é€ä¿¡</button>
      <button>ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      <p>ã€€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚ã€€</p>
      <p>{value}</p>
    </div>
  );
};

export default Render;
```

```tsx:render.test.tx
import React from "react";
import { render, screen } from "@testing-library/react";
import Render from "./Render";

describe("Rendering", () => {
  test("Should render all the elements correctly", async () => {
    // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹
    render(<Render />);

    expect(screen.getByRole("heading")).toBeTruthy();ã€€// h1ã‚¿ã‚°ãŒå­˜åœ¨ã™ã‚‹
    expect(screen.getByRole("textbox")).toBeTruthy(); // inputã‚¿ã‚°ãŒå­˜åœ¨ã™ã‚‹
    expect(screen.getAllByRole("button")[0]).toBeTruthy();ã€€// ã€Œé€ä¿¡ã€ã®buttonã‚¿ã‚°ãŒå­˜åœ¨ã™ã‚‹
    expect(screen.getAllByRole("button")[1]).toBeTruthy(); // ã€Œã‚­ãƒ£ãƒ³ã‚»ãƒ«ã€ã®buttonã‚¿ã‚°ãŒå­˜åœ¨ã™ã‚‹

    // ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰æ¤œç´¢
    // ãªã„å ´åˆã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã¨ãã¯queryByText
    expect(screen.queryByText("test")).toBeNull(); 
    
    // éåŒæœŸã§å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’æ¤œç´¢
    expect(await screen.findByText("async data")).toBeTruthy();
  });
});
```

## ã‚¿ã‚°ã®å–å¾—
ã‚¿ã‚°ã®å–å¾—ã«ã¯`screen.getByText()`ã§å–å¾—ã§ãã¾ã™ã€‚
å–å¾—ã®ç¨®é¡ã¯ä»¥ä¸‹ã®3ç¨®é¡ã‚ã‚Šã¾ã™ã€‚

* `getBy...`
	* ç‰¹å®šã‚¯ã‚¨ãƒªã«ä¸€è‡´ã™ã‚‹è¦ç´ ã‚’å–å¾—ã™ã‚‹
	* è¦ç´ ãŒãªã„æ™‚ã«åˆ©ç”¨ã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã‚¹ãƒ­ãƒ¼ã•ã‚Œã¦ãƒ†ã‚¹ãƒˆå¤±æ•—ã™ã‚‹ã®ã§ã€ãªã„å ´åˆã‚’èª¿ã¹ãŸã„æ™‚ã¯`queryBy...`ã‚’åˆ©ç”¨ã™ã‚‹
* `queryBy...`
	* ç‰¹å®šã‚¯ã‚¨ãƒªãŒä¸€è‡´ã™ã‚‹è¦ç´ ãŒãªã„ã“ã¨ã‚’å–å¾—ã™ã‚‹
* `findBy...`
	* ç‰¹å®šã‚¯ã‚¨ãƒªã«ä¸€è‡´ã™ã‚‹è¦ç´ ã‚’éåŒæœŸã§å–å¾—ã™ã‚‹
	* è¦ç´ ã‚’å–å¾—ã™ã‚‹ã¾ã§æ¢ã™

è©³ã—ãã¯ä»¥ä¸‹å…¬å¼ãƒšãƒ¼ã‚¸å‚ç…§
https://testing-library.com/docs/queries/about/#types-of-queries

å–å¾—ã®ç¨®é¡ã¯ã€`getByText`ã€`getByRole`ã€`getByLabelText`ã€`getByPlaceholderText`ãªã©ãŒã‚ã‚Šã¾ã™ã€‚

è©³ã—ãã¯å…¬å¼ã®ãƒãƒ¼ãƒˆãƒšãƒ¼ã‚¸å‚ç…§ãã ã•ã„ã€‚

https://testing-library.com/docs/dom-testing-library/cheatsheet/#queries


## roleã«ã¤ã„ã¦

å„HTMLã‚¿ã‚°ã«ã¯ã€roleãŒã‚ã‚Šã€ãã¡ã‚‰ã§å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ä¾‹ãˆã°ã€`input`ã‚¿ã‚°, `textarea`ã‚¿ã‚°ã¯ã€`textbox`ã¨ã„ã†roleãŒã‚ã‚Šã¾ã™ã€‚

ã¤ã¾ã‚Š`screen.getByRole("textbox")`ã§å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

å„ã‚¿ã‚°ã®roleä¸€è¦§è¡¨ã¯ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯å‚ç…§ã€‚

https://github.com/A11yance/aria-query#role-to-element


## ãƒãƒƒãƒãƒ£ãƒ¼é–¢æ•°(ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°)
`toBeTruthy()`ã¯è¦ç´ ãŒå­˜åœ¨ã™ã‚‹ã‹ã‚’åˆ¤æ–­ã™ã‚‹ãƒãƒƒãƒãƒ£ãƒ¼é–¢æ•°ã§ã‚ã‚Šã¾ã™ã€‚ä»–ã«ã‚‚ã€ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ãªå€¤ã‚’æ¯”è¼ƒã—ãŸã‚Šã™ã‚‹`toBe()`ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ¯”è¼ƒã™ã‚‹`toBeEqaul`ãªã©ãŒã‚ã‚Šã¾ã™ã€‚

ä¸€è¦§ã¯ä»¥ä¸‹å‚ç…§ã€‚

https://jestjs.io/ja/docs/expect#%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89

ã¾ãŸã€jest-domã§ã¯ã•ã‚‰ã«ä¾¿åˆ©ãªãƒãƒƒãƒãƒ£ãƒ¼ã‚‚ç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚
ä¾‹ãˆã°ã€`toHaveAttribute()`ã¯ã€ã‚¿ã‚°ã®å±æ€§ã‚’èª¿ã¹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

è©³ç´°ã¯ã€ä»¥ä¸‹ã®å…¬å¼ãƒšãƒ¼ã‚¸å‚ç…§ã€‚

https://github.com/testing-library/jest-dom


# ãƒ¦ãƒ¼ã‚¶æ“ä½œã®ãƒ†ã‚¹ãƒˆ
ãƒ¦ãƒ¼ã‚¶æ“ä½œãŒçµ¡ã‚€ãƒ†ã‚¹ãƒˆã¯ã€`@testing-library/user-event`ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚
`userEvent.setup()`ã§ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç”Ÿæˆã‚’ã—ã¦ã€ãã‚Œã«å¯¾ã—æ“ä½œã®ãŸã‚ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚
ãƒ¦ãƒ¼ã‚¶æ“ä½œã¯ã€éåŒæœŸã®ãŸã‚ã€async/awaitå‡¦ç†ã‚’æ–½ã—ã¦ã‚ã’ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ä»¥ä¸‹ãƒ†ã‚¹ãƒˆã®ä¾‹ã‚’è¼‰ã›ã¾ãšã€‚

* ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ¦‚è¦
	* inputã‚¿ã‚°ã«å…¥åŠ›ã—ãŸå†…å®¹ã¯inputã¨ã—ã¦stateã«ä¿æŒ
	* ã€Œã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆã€ãƒœã‚¿ãƒ³æŠ¼ä¸‹
		* stateã®inputã®çŠ¶æ…‹ãŒç©ºæ–‡å­—ãªã‚‰ä½•ã‚‚å®Ÿè¡Œã—ãªã„
		* stateã®inputã®çŠ¶æ…‹ãŒç©ºæ–‡å­—ã§ãªã‘ã‚Œã°ã€ãã®å†…å®¹ãŒoutputé–¢æ•°ã«æ¸¡ã•ã‚Œã€ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆã•ã‚Œã‚‹

```tsx:RenderInput.tsx
import React from "react";

const Render = ({ outputConsole }) => {
  const [input, setInput] = React.useState("");
  const outputValue = () => {
    if (input) {
      outputConsole(input);
    }
  };
  const updateValue = (e) => {
    setInput(e.target.value);
  };
  return (
    <div>
      <input
        type="text"
        placeholder="Enter"
        value={input}
        onChange={updateValue}
      />
      <button onClick={outputValue}>ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆ</button>
    </div>
  );
};

export default RenderInput;
```

```tsx:Render.test.tsx
import React from "react";
import { render, screen, cleanup } from "@testing-library/react";
import userEvent from "@testing-library/user-event";
import Render from "./Render";

// ãƒ†ã‚¹ãƒˆå¾Œã«è¡Œã£ã¦ãã‚Œã‚‹å‡¦ç†
// ãƒ†ã‚¹ãƒˆã‚’è¡Œã†ã¨å‰ã®ãƒ†ã‚¹ãƒˆçµæœãŒæ®‹ã£ã¦ã—ã¾ã†ã“ã¨ãŒã‚ã‚‹ã®ã§ã€clenup()ã§ã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆã•ã›ã‚‹
afterEach(() => cleanup());

describe("å…¥åŠ›è¦ç´ ã®ãƒ†ã‚¹ãƒˆ",  () => {
  test("ãƒ¦ãƒ¼ã‚¶ãŒå…¥åŠ›ã™ã‚‹ã¨ã€inputè¦ç´ ã®valueãŒãã‚Œã«å¿œã˜ã¦ã€æ›´æ–°ã•ã‚Œã‚‹", async () => {
    render(<Render outputConsole={jest.fn()}/>);
    const inputValue = screen.getByPlaceholderText("Enter");
    
    const user = userEvent.setup();
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚¤ãƒ™ãƒ³ãƒˆã€Œtestã€ã‚’å…¥åŠ›
    await user.type(inputValue, "test");
    
    expect(inputValue.value).toBe("test");
  });
});
describe("ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸæ™‚ã®ãƒ†ã‚¹ãƒˆ", () => {
  test("ãƒ†ã‚­ã‚¹ãƒˆã«ä½•ã‚‚å…¥åŠ›ã›ãšã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã‚‚outputé–¢æ•°ã¯å‘¼ã°ã‚Œãªã„", async () => {
    const output = jest.fn();
    render(<Render outputConsole={output} />);
    
    const user = userEvent.setup();
    await user.click(screen.getByRole("button"));
    // æœªå…¥åŠ›ã®ã¨ãå‘¼ã³å‡ºã•ã‚Œãªã„
    expect(output).not.toHaveBeenCalled();
  });
  test("ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›çŠ¶æ…‹ã§ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨é–¢æ•°ãŒ1å›ã‚ˆã°ã‚Œã‚‹", async () => {
    const output = jest.fn();
    render(<Render outputConsole={output} />);
    const inputValue = screen.getByPlaceholderText("Enter");
    
    const user = userEvent.setup();
    await user.type(inputValue, "test");
    await user.click(screen.getByRole("button"));
    
    expect(output).toHaveBeenCalledTimes(1);
  });
});
```

## userEventã®ç¨®é¡

ãƒ¦ãƒ¼ã‚¶ã‚¤ãƒ™ãƒ³ãƒˆã¯ä»–ã«ã‚‚ã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œã‚„ãƒã‚¦ã‚¹æ“ä½œãªã©ãŒã§ãã¾ã™ã€‚ãƒ›ãƒãƒ¼æ™‚ã‚„ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯æ™‚ãªã©ã‹ãªã‚Šç´°ã‹ããƒ¦ãƒ¼ã‚¶æ“ä½œã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
è©³ã—ãã¯ä»¥ä¸‹ã®å…¬å¼ãƒšãƒ¼ã‚¸ã‚’å‚ç…§ãã ã•ã„ã€‚


https://testing-library.com/docs/user-event/intro

## é–¢æ•°ã®ãƒ¢ãƒƒã‚¯

`jest.fn()`ã‚’ä½¿ã†ã“ã¨ã§é–¢æ•°ã‚’ãƒ¢ãƒƒã‚¯åŒ–ã™ã‚‹äº‹ãŒã§ãã¾ã™ã€‚

ãƒ¢ãƒƒã‚¯é–¢æ•°ã«ã¯ã€.mockãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒã‚ã‚Šã€ãƒ¢ãƒƒã‚¯é–¢æ•°å‘¼ã³å‡ºã—æ™‚ã®ãƒ‡ãƒ¼ã‚¿ã¨ã€é–¢æ•°ã®è¿”ã‚Šå€¤ãŒè¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã™ã€‚

```
const mockFn = jest.fn();
mockFn.mock.calls;        // é–¢æ•°ãŒã©ã®ã‚ˆã†ã«å‘¼ã³å‡ºã•ã‚ŒãŸã‹ï¼ˆé…åˆ—ï¼‰
mockFn.mock.results;      // è¿”ã‚Šå€¤ãŒä½•ã§ã‚ã£ãŸã‹ï¼ˆé…åˆ—ï¼‰
mockFn.mock.instances;    // ã©ã®ã‚ˆã†ã«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã•ã‚ŒãŸã‹ï¼ˆé…åˆ—ï¼‰
```

```tsx
// outputé–¢æ•°ã®è¿”ã‚Šå€¤ã«'Hoge'ã‚’è¨­å®š
const output = jest.fn().mockImplementation(() => "Hoge"); 

// çœç•¥ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½
const output = jest.fn(() => "Hoge");
```

è©³ç´°ã¯ä»¥ä¸‹å‚ç…§

https://jestjs.io/ja/docs/mock-functions


# APIã®ãƒ†ã‚¹ãƒˆ

APIã®ãƒ†ã‚¹ãƒˆã§ã¯ã€å®Ÿéš›ã®ã‚µãƒ¼ãƒãƒ¼ã«å¯¾ã—ã¦è¡Œã†ã®ã¯ã‚ˆããªã„ã§ã™ã€‚ç†ç”±ã¯ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®çµæœã«ã‚ˆã£ã¦ãƒ†ã‚¹ãƒˆçµæœãŒå¤‰ã‚ã‚‹ãŸã‚ã§ã™ã€‚ã¤ã¾ã‚Šã€ãƒ†ã‚¹ãƒˆã™ã‚‹æ™‚æœŸãƒ»å ´æ‰€ï¼ˆé€šä¿¡çŠ¶æ³ãŒæ‚ªã„å ´æ‰€ï¼‰ã«ã‚ˆã£ã¦ãƒ†ã‚¹ãƒˆã®çµæœãŒå¤‰ã‚ã‚‹ã®ã¯ã‚ˆããªã„ã§ã™ã€‚

ãã“ã§ã€å®Ÿéš›ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã®ã¯ãªãã€ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™ã‚ˆã†ã«ã—ã¦ã‚ã’ã¾ã™ã€‚
ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒãƒ¼ã«å¯¾ã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã—ã¦ã€ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã—ã¾ã™ã€‚
ã“ã®ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒãƒ¼ã‚’å®Ÿç¾ã™ã‚‹ã«ã¯ã€MSWã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã„ã¾ã™ã€‚

https://mswjs.io/

æ¬¡ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆã‚’è€ƒãˆã¾ã™ã€‚

* ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ¦‚è¦
	* ã€ŒAPIã‚’å®Ÿè¡Œã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ä¸‹ã™ã‚‹ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
	* å–å¾—ã«æˆåŠŸã™ã‚‹ã¨ãƒœã‚¿ãƒ³ã®ä¸‹ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’è¡¨ç¤ºï¼ˆãƒœã‚¿ãƒ³ã¯éæ´»æ€§ã«ãªã‚‹ï¼‰
	* å–å¾—ã«å¤±æ•—ã™ã‚‹ã¨ãƒœã‚¿ãƒ³ã®ä¸‹ã«ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤º

```tsx:MockServer.tsx
import React from "react";
import axios from "axios";

const MockServer = () => {
  const [clicked, setClicked] = React.useState(false);
  const [username, setUserName] = React.useState("");
  const [error, setError] = React.useState("");

  const fetchUser = async () => {
    try {
       const res = await axios.get("https://jsonplaceholder.typicode.com/users/1");
       const { username } = res.data;
       setUserName(username);
       setClicked(prevState => !prevState);
    } catch {
       setError("å¤±æ•—ã—ã¾ã—ãŸã€‚");
    }
  };
  const buttonText = clicked ? "å–å¾—ã—ã¾ã—ãŸ" : "å–å¾—ã™ã‚‹";
  
  return (
    <div>
      <button onClick={fetchUser} disabled={clicked}>
        {buttonText}
      </button>
      {username && <h3>{username}</h3>}
      {error && <p data-testid="error">{error}</p>}
    </div>
  );
};

export default MockServer;
```

```tsx:MockServer.test.tsx
import React from "react";
import { cleanup, render, screen } from "@testing-library/react";
import MockServer from "./MockServer";
import { rest } from "msw";
import { setupServer } from "msw/node";
import userEvent from "@testing-library/user-event";

// ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒãƒ¼ã®è¨­å®š
const server = setupServer(
  rest.get("https://jsonplaceholder.typicode.com/users/1", (req, res, ctx) => {
    return res(ctx.status(200), ctx.json({ username: "Bred dummy" }));
  })
);

// æœ€åˆã«ä¸€å›ã ã‘å®Ÿè¡Œã•ã‚Œã‚‹ ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•
beforeAll(() => server.listen());

afterEach(() => {
  // ã‚µãƒ¼ãƒãƒ¼ãƒªã‚»ãƒƒãƒˆ
  server.resetHandlers();
  cleanup();
});

// æœ€å¾Œã«ä¸€å›ã ã‘å®Ÿè¡Œã•ã‚Œã‚‹ ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒãƒ¼çµ‚äº†
afterAll(() => server.close());

describe("Mock APIã®ãƒ†ã‚¹ãƒˆ", () => {
  test("æˆåŠŸæ™‚ã®ãƒ†ã‚¹ãƒˆ", async () => {
    render(<MockServer />);
    
    const user = userEvent.setup();
    await user.click(screen.getByRole("button"));
    
    expect(await screen.findByText("Bred dummy")).toBeInTheDocument();
    expect(screen.getByRole("button")).toHaveAttribute("disabled");
  });
  
  test("ãƒªã‚¯ã‚¨ã‚¹ãƒˆå¤±æ•—æ™‚ã¯ã€ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹", async () => {
    // ã‚µãƒ¼ãƒãƒ¼ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’æ›¸ãæ›ãˆã‚‹(useã‚’ä½¿ã†ã“ã¨ã§ã€ã“ã“ã®ä¸­ã ã‘ã§æœ‰åŠ¹)
    server.use(
      rest.get(
        "https://jsonplaceholder.typicode.com/users/1",
        (req, res, ctx) => {
          return res(ctx.status(404));
        }
      )
    );
    
    render(<MockServer />);
    
    const user = userEvent.setup();
    await user.click(screen.getByRole("button"));
    
    expect(await screen.findByTestId("error")).toHaveTextContent(
      "å¤±æ•—ã—ã¾ã—ãŸã€‚"
    );
    
    expect(screen.queryByRole("heading")).toBeNull();
    
    expect(screen.getByRole("button")).not.toHaveAttribute("disabled");
  });
});
```
ã€€
 ## MSW
ã€€MSWã§ã¯ã€ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’ä½œã‚Šã€ãã‚Œã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦å—ã‘å–ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
`setServer`ã«ãã®è¨­å®šã‚’æ›¸ãã¾ã™ã€‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹URLã¨ãã‚Œã«å¯¾ã™ã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¨˜è¿°ã—ã¾ã™ã€‚
ãã†ã™ã‚‹ã¨ãªã‚“ã‚„ã‹ã®HTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆaxios, fetchãªã©ï¼‰ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã£ãŸéš›ã«ã€è¨­å®šã—ãŸãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ãŒãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦è¿”ã£ã¦ãã¾ã™ã€‚

ã€€ã¾ãŸã€ãƒ†ã‚¹ãƒˆã ã‘ã§ã¯ãªãã€APIãŒã§ãã¦ã„ãªã„æ™‚ã®ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ã®å…ˆè¡Œé–‹ç™ºã‚„ã€Strorybookã‚’åˆ©ç”¨ã™ã‚‹éš›ã®ãƒ¢ãƒƒã‚¯ã«ã‚‚åˆ©ç”¨ã§ãã‚‹ãŸã‚ã€ã‹ãªã‚Šä¾¿åˆ©ã§ã™ã€‚
 
 # Reduxã®ã‚¹ãƒˆã‚¢ã‚’å«ã‚ãŸãƒ†ã‚¹ãƒˆ
 
 Reduxã‚’ã‚¹ãƒˆã‚¢ã‚’å«ã‚ãŸãƒ†ã‚¹ãƒˆã®ä¾‹ã‚’ç¤ºã™ã€‚
 
* ä¸Šè¨˜Reduxã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒå®Ÿè¡Œã•ã‚Œã‚‹ãƒœã‚¿ãƒ³ãŒ3ã¤
	* ã€Œï¼‹ã€ãƒœã‚¿ãƒ³ã€€æŠ¼ä¸‹ã™ã‚‹ã¨incrementã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒå®Ÿè¡Œã•ã‚Œã€modeã«å¿œã˜ã§ã‚¹ãƒ†ãƒ¼ãƒˆå€¤ã‚’å¢—ã‚„ã™
	* ã€Œãƒ¼ã€ãƒœã‚¿ãƒ³ã€€æŠ¼ä¸‹ã™ã‚‹ã¨decrementã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒå®Ÿè¡Œã•ã‚Œã€modeã«å¿œã˜ã¦ã‚¹ãƒ†ãƒ¼ãƒˆå€¤ã‚’æ¸›ã‚‰ã™
	* ã€Œå€¤ã‚’è¿½åŠ ã€ãƒœã‚¿ãƒ³ã¨å…¥åŠ›æ¬„ã€€ãƒœã‚¿ãƒ³æŠ¼ä¸‹ã™ã‚‹ã¨å…¥åŠ›æ¬„ã®å…¥åŠ›å€¤ã‚’å¼•æ•°ã¨ã—ãŸincrementByAmountã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒå®Ÿè¡Œã•ã‚Œã€modeã«å¿œã˜ãŸã‹ã¤å…¥åŠ›ã—ãŸå€¤ãŒã‚¹ãƒ†ãƒ¼ãƒˆã«è¿½åŠ ã•ã‚Œã‚‹
* è¨ˆç®—çµæœvalue ã‚’è¡¨ç¤º

```ts:slice.ts
import { createSlice, createAsyncThunk } from "@reduxjs/toolkit";

export const customCounterSlice = createSlice({
  name: "customCounter",
  initialState: {
    // æ•°ã«ã‚ˆã£ã¦è¨ˆç®—å‡¦ç†ã®æ–¹æ³•ã‚’å¤‰ãˆã‚‹
    mode: 0,
    // è¨ˆç®—å€¤
    value: 0,
  },
  reducers: {
    increment: (state) => {
      switch (state.mode) {
        case 0:
          state.value += 1;
          break;
        case 1:
          state.value += 100;
          break;
        case 2:
          state.value += 10000;
          break;
        default:
          break;
      }
    },
    decrement: (state) => {
      state.value -= 1;
    },
    incrementByAmount: (state, action) => {
      switch (state.mode) {
        case 0:
          state.value += action.payload;
          break;
        case 1:
          state.value += 100 * action.payload;
          break;
        case 2:
          state.value += 10000 * action.payload;
        default:
          break;
      }
    },
  },
});

export const { increment, decrement, incrementByAmount } =
  customCounterSlice.actions;

export const selectCount = (state) => state.customCounter.value;

export default customCounterSlice.reducer;
```

```tsx:Redux.tsx
import React from "react";
import { useSelector, useDispatch } from "react-redux";
import {
  selectCount,
  increment,
  decrement,
  incrementByAmount,
} from "./features/customCounter/customCounterSlice";

const Redux = () => {
  const [number, setNumber] = React.useState(0);
  const count = useSelector(selectCount);
  const dispatch = useDispatch();

  return (
    <div>
      <div>
        {/* 1ãƒ—ãƒ©ã‚¹ */}
        <button onClick={() => dispatch(increment())}>+</button>
        <span data-testid="count-value">{count}</span>
        {/* 1ãƒã‚¤ãƒŠã‚¹ */}
        <button onClick={() => dispatch(decrement())}>-</button>
        {/* å…¥åŠ›å€¤åˆ†ãƒ—ãƒ©ã‚¹ (numberãŒç„¡åŠ¹ãªå€¤ã®ã¨ã0ã§å®Ÿè¡Œ)*/}
        <button onClick={() => dispatch(incrementByAmount(number | 0))}>
          å€¤ã‚’è¿½åŠ 
        </button>
        <input
          type="text"
          placeholder="Enter"
          value={number}
          onChange={(e) => setNumber(e.target.value)}
        ></input>
      </div>
    </div>
  );
};
export default Redux;
```

```tsx:Redux.test.tsx
import React from "react";
import { render, screen, cleanup } from "@testing-library/react";
import userEvent from "@testing-library/user-event";
import { Provider } from "react-redux";
import Redux from "./Redux";
import { configureStore } from "@reduxjs/toolkit";
import customCounterReducer from "../src/features/customCounter/customCounterSlice";
// å®Ÿéš›ã«Reduxã®ã‚¹ãƒ†ãƒ¼ãƒˆã‚’åˆ©ç”¨
import { store } from './store';

afterEach(() => {
  cleanup();
});

describe("ã‚¹ãƒˆã‚¢ã®ãƒ†ã‚¹ãƒˆ", () => {
  test("ã€Œï¼‹ã€ã‚’3å›æŠ¼ã™ã¨ã‚«ã‚¦ãƒ³ãƒˆã¯3ã«ãªã‚‹", async () => {
    render(
      <Provider store={store}>
        <Redux />
      </Provider>
    );
    const user = userEvent.setup();
    await user.click(screen.getByText("+"));
    await user.click(screen.getByText("+"));
    await user.click(screen.getByText("+"));
    
    expect(screen.getByTestId("count-value")).toHaveTextContent(3);
  });
  test("å…¥åŠ›è¦ç´ ã«å€¤50ã‚’ç›´æ¥ä»£å…¥ã—ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã‚‰ã‚«ã‚¦ãƒ³ãƒˆ50ã«ãªã‚‹", () => {
    render(
      <Provider store={store}>
        <Redux />
      </Provider>
    );
    const user = userEvent.setup();
    await user.type(screen.getByPlaceholderText("Enter"), "50");
    await user.click(screen.getByText("å€¤ã‚’è¿½åŠ "));
    
    expect(screen.getByTestId("count-value")).toHaveTextContent(50);
  });
});
```

## ã‚¹ãƒˆã‚¢ã®åˆ©ç”¨
ã‚¹ãƒˆã‚¢ã‚’åˆ©ç”¨ã™ã‚‹éš›ã¯ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’Providerã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ãƒ©ãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã†ã™ã‚‹ã“ã¨ã§ã€ã‚¹ãƒˆã‚¢ã®ãƒ†ã‚¹ãƒˆã‚‚æœ‰åŠ¹ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã¾ãŸã€ãã®æ™‚ã«åˆ©ç”¨ã™ã‚‹storeã¯å®Ÿéš›ã«åˆ©ç”¨ã—ã¦ã„ã‚‹storeã‚’åˆ©ç”¨ã—ã¾ã™ã€‚ãã†ã™ã‚‹ã“ã¨ã§ã€æœ¬ç•ªåŒæ§˜ã®ã‚¹ãƒˆã‚¢ã‚’åˆ©ç”¨ã—ã¦ãƒ†ã‚¹ãƒˆãŒã§ãã¾ã™ã€‚


# ãƒ†ã‚¹ãƒˆã‚’ä½œã‚‹æ™‚ã«æ°—ã‚’ã¤ã‘ã¦ã„ã‚‹ã“ã¨
* 1ãƒ†ã‚¹ãƒˆ1ã‚¢ã‚µãƒ¼ãƒˆã«ã™ã‚‹
    * ä¾‹å¤–ãŒã§ãŸæ™‚ç‚¹ã§ã€ä»¥é™ã®ãƒ†ã‚¹ãƒˆãŒå®Ÿè¡Œã•ã‚Œãªã„
    * ã©ã®ã‚¢ã‚µãƒ¼ãƒˆãŒå¤±æ•—ã—ãŸã®ã‹ãŒã™ãã‚ã‹ã‚‰ãªã„
    * ãŸã è¤‡æ•°æˆåŠŸã—ãªã„ã¨ã„ã‘ãªã„ã¨ãƒ†ã‚¹ãƒˆã¯ä¾‹å¤–

```ts
// NG
test('test',() => {
  expect().toBe();
  expect().toBe();
})

// OK
test('test1',() => {
  expect().toBe();
})
test('test2',() => {
  expect().toBe();
})
```

* ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã«ãŠã‘ã‚‹é‡è¤‡ã‚‚ç„¡ãã™
    * beforeEach,afterEach,beforeAllãªã©ã‚’é©åˆ‡ã«åˆ©ç”¨ã™ã‚‹

```ts
// NG
test("1", () => {
  render(<Conponent />);
  expect(screen.getByText("hoge")).toBeTruthy();
});
test("2", () => {
  render(<Conponent />);
  expect(screen.getByText("foo")).toBeTruthy();
});

// OK
beforeEach(() => {
  render(<Conponent />);
});
test("1", () => {
  expect(screen.getByText("hoge")).toBeTruthy();
});
test("2", () => {
  expect(screen.getByText("foo")).toBeTruthy();
});
```

* ãƒ†ã‚¹ãƒˆæ›¸ãã‚„ã™ã„ã‚³ãƒ¼ãƒ‰ã¯ãªã«ãªã®ã‹ã‚’è€ƒãˆãªãŒã‚‰ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã
    * ï¼‘ãƒ¡ã‚½ãƒƒãƒ‰ï¼‘ã¤ã®ã“ã¨ã‚„ã£ã¦ã„ã‚‹ã®ã‹ï¼Ÿ
    * ï¼‘ã¤ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒå°ã•ã„ã‹ï¼Ÿ
    * è¨­è¨ˆã‚’å­¦ã¶

* ä»•æ§˜ãŒã‚ã‹ã‚‹ã‚ˆã†ã«æ›¸ãã€ãã®å¾Œå…·ä½“ä¾‹ã®ãƒ†ã‚¹ãƒˆã‚’æ›¸ã
	* ãƒã‚¹ãƒˆã§åŒºåˆ‡ã£ã¦ã‚ã’ã‚‹ã¨ã€ã¿ã‚„ã™ã„
	* ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚‚ãªã‚‹ã—ã€åˆã‚ã¦ã¿ãŸäººã§ã®ã™ãã‚­ãƒ£ãƒƒãƒã‚¢ãƒƒãƒ—ã§ãã‚‹

```ts:sample.test.tsx
// ã©ã†è¨€ã£ãŸã‚¯ãƒ©ã‚¹ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€é–¢æ•°ãªã®ã‹ï¼Ÿ
describe('ã“ã‚Œã¯ã€œã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆé–¢æ•°ã€ã‚¯ãƒ©ã‚¹ï¼‰', () => {
  // ã©ã†è¨€ã£ãŸã“ã¨ã‚’ã™ã‚‹æ©Ÿèƒ½ã‚’æŒã£ã¦ã„ã‚‹ã®ã‹ï¼Ÿ
  describe('ã€œï¼ˆå¼•æ•°ï¼‰ã‚’ã€œï¼ˆè¿”ã‚Šè¡€ï¼‰ã«ã™ã‚‹', () => {
    // å…·ä½“ä¾‹ãªå®Ÿéš›ã®å€¤ã«å¯¾ã—ã¦ã©ã†ã™ã‚‹ã®ã‹ï¼Ÿ
    test('ã€œãŒã€Œtrueã€ã®å ´åˆã€ã€œã«ãªã‚‹', () => {
    
    });
  });
});
```

* é©å½“ã«æ›¸ãã®ã§ã¯ãªãã€å³é¸ã—ã¦æ›¸ã
    * å¿…è¦æœ€ä½é™ã™ã‚‹
    * åŒã˜ã‚ˆã†ãªãƒ†ã‚¹ãƒˆã¯æ›¸ã‹ãªã„
    * ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚³ã‚¹ãƒˆã€é–‹ç™ºã‚³ã‚¹ãƒˆãŒã‹ã‹ã‚Šã‹ãˆã£ã¦æŠ€è¡“è² å‚µã«ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
    * ä¾‹ï¼‰å¢ƒç•Œå€¤ã®éƒ¨åˆ†ã¯ãƒã‚°ã«ãªã‚Šã‚„ã™ã„ãŸã‚ã€ç¶²ç¾…ã™ã‚‹ãªã©


# ã¾ã¨ã‚
ä»¥ä¸Šã€ç°¡å˜ãªãƒ†ã‚¹ãƒˆã¨ã€ãƒ†ã‚¹ãƒˆã‚’æ›¸ãéš›ã®è¦³ç‚¹ã‚’ã¾ã¨ã‚ã¦ã¿ã¾ã—ãŸã€‚

# å‚è€ƒ
https://www.youtube.com/watch?v=Q-FJ3XmFlT8&ab_channel=TDDBC-Online